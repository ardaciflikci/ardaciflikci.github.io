<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kurtarma Oyunu â€” Kahve Teklifi â˜•</title>
<style>
  body{
    margin:0;padding:0;font-family:Inter,Arial;
    background:linear-gradient(135deg,#ffe6ec,#fff8f2);
    display:flex;flex-direction:column;align-items:center;user-select:none;
  }
  #startScreen{
    position:fixed;inset:0;background:#ffe6ec;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    text-align:center;padding:20px;
  }
  #startBtn{
    background:#ff77a9;color:white;border:none;padding:14px 22px;
    border-radius:12px;font-size:20px;cursor:pointer;
  }
  canvas{
    background:#fce4ec;border-radius:12px;image-rendering:pixelated;
    box-shadow:0 8px 30px rgba(0,0,0,0.15);margin-top:20px;
  }
  #messageBox,#questionBox,#pickupBox,#dateBox,#timeBox,#summaryBox{
    display:none;background:white;padding:18px;border-radius:12px;
    margin-top:20px;width:90%;max-width:420px;text-align:center;
    box-shadow:0 8px 30px rgba(0,0,0,0.15);
  }
  .btn{
    background:#ff7ea8;color:white;border:none;padding:12px 16px;
    border-radius:10px;cursor:pointer;font-size:16px;margin:6px;
  }
  .btn.secondary{background:#ffd1d1;color:#b84c4c;}
  input{
    width:90%;padding:10px;border:1px solid #ccc;border-radius:8px;
    margin-top:10px;
  }
</style>
</head>
<body>

<div id="startScreen">
  <h1 style="color:#c7426b">Bir Prenses Tehlikede ğŸ‘‘</h1>
  <p style="max-width:420px;color:#6b4050">
    KaranlÄ±k yaratÄ±klar prensesi pembe diyara hapsetti.  
    KahramanÄ±mÄ±z onu kurtarmalÄ±â€¦ Belki sonunda gÃ¼zel bir teklif yapar ğŸ˜‰â˜•
  </p>
  <button id="startBtn">GÃ¶revi BaÅŸlat ğŸš€</button>
</div>

<h2 style="color:#c7426b;margin-top:20px;">Prensesi kurtar! ğŸ’–</h2>
<p style="color:#6b4050;margin:-10px 0 10px;">ZÄ±plamak iÃ§in <b>BoÅŸluk</b> veya dokun</p>

<canvas id="game" width="780" height="330"></canvas>

<!-- âœ… Ä°lk final: prenses kurtarÄ±ldÄ± -->
<div id="messageBox">
  <h2>Prenses kurtarÄ±ldÄ±! ğŸ‘‘ğŸ’—</h2>
  <canvas id="finalCanvas" width="320" height="150" style="margin-bottom:10px;"></canvas>
  <p>Benimle kahve iÃ§mek ister misin? â˜•ğŸ’</p>
  <button class="btn" id="qYes">Evet â¤ï¸</button>
  <button class="btn secondary" id="qNo">HayÄ±r ğŸ˜Š</button>
</div>

<!-- âœ… Soru 2: seni alayÄ±m mÄ±? -->
<div id="questionBox">
  <p>Seni almamÄ± ister misin? ğŸš—</p>
  <button class="btn" id="pickupYes">Evet</button>
  <button class="btn secondary" id="pickupNo">HayÄ±r</button>
</div>

<!-- âœ… Soru 3: nereden alayÄ±m? -->
<div id="pickupBox">
  <p>Beni nereden almamÄ± istersin?</p>
  <input id="address" placeholder="Adresini yaz"/>
  <button class="btn" id="pickupContinue">Devam</button>
</div>

<!-- âœ… Soru 4: hangi gÃ¼n? -->
<div id="dateBox">
  <p>Hangi gÃ¼n buluÅŸalÄ±m?</p>
  <input type="date" id="dateInput"/>
  <button class="btn" id="dateContinue">Devam</button>
</div>

<!-- âœ… Soru 5: saat kaÃ§ta? -->
<div id="timeBox">
  <p>Hangi saatte?</p>
  <input type="time" id="timeInput"/>
  <button class="btn" id="timeContinue">Devam</button>
</div>

<!-- âœ… Final Ã¶zet -->
<div id="summaryBox">
  <h2>Randevu HazÄ±r! ğŸ’</h2>
  <p id="summaryText"></p>
</div>

<script>
/* ================================
   SPRITE PALETTE
================================ */
const color={R:'#d7263d',B:'#2b7abf',L:'#ffd166',S:'#ffd9b3',K:'#111',P:'#3b82c4',Y:'#ffd966',W:'#fff'};
function drawSprite(ctx,p,x,y,s){for(let r=0;r<p.length;r++){for(let c=0;c<p[r].length;c++){if(p[r][c]!==' . '[0]){ctx.fillStyle=color[p[r][c]];ctx.fillRect(x+c*s,y+r*s,s,s);}}}}

/* Hero & Princess sprites */
const heroP=[
"................","......KKKK......",".....KRRRRK.....","....KRBBBBRK....","...KRBBBBBBK....",
"...KRBBLBBRK....","...KRRLLRRRK....","....KRRRRRK.....","....KRBSSBRK....","...KKSSSSSKK....",
"...KSSSSSSSK....","...KSS..SSSK....","....KSSSSSK.....","....KSSSSK......",".....KKKKK......","................"
];
const princessA=[
"................",".......KKK......","......KYYYK.....",".....KYYYYK.....",".....KPYPPK.....",
"....KPPPPPK.....","....KPPPPPK.....","....KPPPPPK.....","...KKPPPPKK.....","...KPPPPPPK.....",
"...KPPPPPPK.....","....KPPPPK......","....KPPPK.......",".....KKK........","................","................"
];
const princessB=[
"................",".......KKK......","......KYYYK.....",".....KYYYYK.....",".....KPYPPK.....",
"....KPPPPPK.....","....KPPWPPK.....","....KPPPWPK.....","...KKPPPPKK.....","...KPPPPPPK.....",
"...KPPPPPPK.....","....KPPPPK......","....KPPPK.......",".....KKK........","................","................"
];

/* ================================
   GAME ENGINE â€” HERO FIXED, WORLD MOVES
================================ */
const c=document.getElementById("game");
const ctx=c.getContext("2d");
let hero={x:70,y:220,w:40,h:40,vy:0,jumping:false};
let worldX=0;
let worldSpeed=2.2;  // â­ hÄ±zlandÄ±rÄ±lmÄ±ÅŸ
let obstacles=[];
let princessX=1800; // â­ oyun daha uzun
let started=false,over=false,reached=false,frame=0;

/* Jump */
function jump(){ if(started&&!over&&!reached&&!hero.jumping){ hero.jumping=true; hero.vy=-18; }}

/* Input */
document.addEventListener("keydown",e=>{ if(e.code==="Space"){e.preventDefault();jump();}});
c.addEventListener("pointerdown",jump);

/* Spawn obstacles */
function spawnObs(){
  const h=26+Math.random()*10;
  obstacles.push({x:worldX+780+40,y:280-h,w:30,h});
}
setInterval(()=>{if(started&&!reached)spawnObs();},1500);

/* Rect collision */
function col(a,b){return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);}

/* Background */
function drawBG(){
  ctx.fillStyle="#ffdce5";ctx.fillRect(0,0,780,100);
  for(let i=0;i<6;i++){
    let x=(( -worldX*0.4)+i*200)%1000-150;
    ctx.fillStyle="#fff4fa";ctx.fillRect(x,40+(i%2)*10,130,24);
  }
}

/* MAIN LOOP */
function loop(){
  ctx.clearRect(0,0,780,330);
  drawBG();
  ctx.fillStyle="#f4d6de";ctx.fillRect(0,280,780,50);

  if(started&&!reached){ worldX+=worldSpeed; frame++; }

  // Princess
  const pF=(Math.floor(frame/20)%2===0?princessA:princessB);
  drawSprite(ctx,pF,princessX-worldX,200,3);

  // Obstacles
  ctx.fillStyle="#b71c46";
  obstacles.forEach(o=>{
    const sx=o.x-worldX;
    ctx.fillRect(sx,o.y,o.w,o.h);
    if(col(hero,{x:sx,y:o.y,w:o.w,h:o.h})){ over=true; alert("Kahraman dÃ¼ÅŸtÃ¼ ğŸ˜…"); location.reload();}
  });

  // Hero
  if(hero.jumping){ hero.vy+=0.6; hero.y+=hero.vy;
    if(hero.y>=220){hero.y=220;hero.jumping=false;} }
  drawSprite(ctx,heroP,hero.x,hero.y,2.6);

  // Reached princess
  if((princessX-worldX)<=hero.x+hero.w && !reached){ reached=true; setTimeout(showFinal,300); }

  requestAnimationFrame(loop);
}
loop();

/* ================================
   FINAL SCENE
================================ */
function showFinal(){
  document.getElementById("messageBox").style.display="block";

  const fc=document.getElementById("finalCanvas");
  const fctx=fc.getContext("2d");
  let cy=120,t=0;

  function anim(){
    fctx.clearRect(0,0,320,150);
    drawSprite(fctx,heroP,40,50,3);
    drawSprite(fctx,(t%40<20?princessA:princessB),200,50,3);

    fctx.fillStyle="#6f3b3b";fctx.fillRect(140,cy,30,20);
    fctx.fillStyle="#fff";fctx.fillRect(142,cy+4,26,12);
    cy-=0.35;if(cy<80)cy=120;

    t++;requestAnimationFrame(anim);
  }
  anim();
}

/* ================================
   QUESTION FLOW
================================ */
let wantCoffee="",wantPickup="",addr="",day="",time="";

/* Q1 */
qYes.addEventListener("click",()=>{ wantCoffee="Evet"; nextFlow(questionBox); });
qNo.addEventListener("click",()=>{ wantCoffee="HayÄ±r"; summary(); });

/* Q2 */
pickupYes.addEventListener("click",()=>{ wantPickup="Evet"; nextFlow(pickupBox);});
pickupNo.addEventListener("click",()=>{ wantPickup="HayÄ±r"; nextFlow(dateBox);});

/* Q3 */
pickupContinue.addEventListener("click",()=>{
  addr=document.getElementById("address").value;
  nextFlow(dateBox);
});

/* Q4 */
dateContinue.addEventListener("click",()=>{
  day=document.getElementById("dateInput").value;
  nextFlow(timeBox);
});

/* Q5 */
timeContinue.addEventListener("click",()=>{
  time=document.getElementById("timeInput").value;
  summary();
});

function nextFlow(show){
  hideAll();
  show.style.display="block";
}

function hideAll(){
  messageBox.style.display="none";
  questionBox.style.display="none";
  pickupBox.style.display="none";
  dateBox.style.display="none";
  timeBox.style.display="none";
  summaryBox.style.display="none";
}

function summary(){
  hideAll();
  summaryBox.style.display="block";

  let txt="ğŸ’— Randevu OluÅŸturuldu!<br><br>";
  txt+=`Kahve: <b>${wantCoffee}</b><br>`;
  if(wantPickup) txt+=`Seni alayÄ±m mÄ±?: <b>${wantPickup}</b><br>`;
  if(addr) txt+=`Adres: <b>${addr}</b><br>`;
  if(day) txt+=`Tarih: <b>${day}</b><br>`;
  if(time) txt+=`Saat: <b>${time}</b><br>`;
  summaryText.innerHTML=txt;
}

/* Start */
startBtn.onclick=()=>{document.getElementById("startScreen").style.display="none";started=true;};
</script>
</body>
</html>
